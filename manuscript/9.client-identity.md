#客户识别

我喜欢到一家老字号吃饭，点上韩包子，钟水饺之类的小吃，来个美味。我点了单交了钱，店家会给我一个牌，上有一个数字。最近一次给我的是25号，我放这个牌子在桌上。因为有了这个的标识手段，几个服务员就知道把我的（25号）小吃给我，别人的（比如我后面的26号）不能给我。这就是店家（服务器）对客人（客户端）的标识手段。

哪怕只是实现购物车功能，服务器也得需要区别客户的。HTTP协议以Cookie技术来应对此需求。

Cookie就是用于标识的一个字符串。它会对每个来访的首次来访的客户发一个不同的字符串，客户端会存下此字符串，以便在接下来的同一（或者一组）访问事务中告诉此字符串给服务器，这样服务器就知道此次访问时之前的哪个客户端了。过程是这样的：

假设两个客户端来访，A和B。

A首次访问，服务器响应：

    HTTP/1.1 200 OK
    Set-Cookie:id=25

    这是你的首访
B首次访问，服务器响应：

    HTTP/1.1 200 OK
    Set-Cookie:id=26

    这是你的首访


A再次访问，发送之前的Cookie给服务器：

    GET /A HTTP/1.1
    Cookie: id=25

服务器解析Cookie头字段，知道这个客户是A，可以做出个性响应：

    HTTP/1.1 200 OK

    欢迎你第二次访问，你的号牌为25

B首次访问，带上Cookie

    GET /A HTTP/1.1
    Cookie: id=26


服务器响应：

    HTTP/1.1 200 OK
    Set-Cookie:id=26

    欢迎你第二次访问，你的号牌为26

有了这个客户端识别ID，有趣的事儿就可以发生了。这个id，可以用来作为会话ID，服务器以此ID作为索引，用一个数据结构存储客户端用户的更多信息，比如email，昵称，密码登用户信息，实现WebForm登录。

##格式

Cookie并不是只能存储ID，你可以使用键值对，可以这样：

    Cookie: name="1000copy"; charactor="strong";height="175cm"


还可以指定特殊的键值对，以便指示Cookie的使用范围（DOMAIN）、失效日期（Expires）、安全（SECURE）:


    Cookie: name="1000copy";Expires=Wed, 09 Jun 2021 10:18:14 GMT
    


它的格式设计是面向通用目的的:


    Set-Cookie:
       name=value
       [;EXPIRES=dateValue]
       [;DOMAIN=domainName]
       [;PATH=pathName]
       [;SECURE]

这个格式是网景公司首次提出和使用的，其他的浏览器也支持此格式。
之后，也有经过RFC的规范过程，提出了Set-Cookie2,Cookies的格式，显得稍微复杂，且用户代理实现不一。而原理和网景公司的首版是一样的。有兴趣的，可以参看rfc6265。

